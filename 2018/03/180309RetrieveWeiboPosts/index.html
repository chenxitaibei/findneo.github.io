<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Time is of the essence."><title>收集整理一个人所有的微博 | findneo</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">收集整理一个人所有的微博</h1><a id="logo" href="/.">findneo</a><p class="description">Time is of the essence.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">收集整理一个人所有的微博</h1><div class="post-meta">Mar 9, 2018<span> | </span><span class="category"><a href="/categories/备忘/">备忘</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#方法二实践"><span class="toc-number">1.</span> <span class="toc-text">方法二实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方法三实践"><span class="toc-number">2.</span> <span class="toc-text">方法三实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#处理json"><span class="toc-number">3.</span> <span class="toc-text">处理json</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#收获"><span class="toc-number">4.</span> <span class="toc-text">收获</span></a></li></ol></div></div><div class="post-content"><blockquote>
<p>项目地址在  <a href="https://github.com/findneo/TKposts" target="_blank" rel="external">https://github.com/findneo/TKposts</a> </p>
</blockquote>
<p>人生活在社区里，对一个常使用微博的人来说，微博记录和反映了他在一段时间内所接触的信息，思考的问题和表达的观点，是值得研究的。如果这个研究对象是一个优秀的人，这里面的价值可能比想象要大。</p>
<p>很显然，要做成<code>收集整理一个人所有的微博</code> 这件事，首先是收集，其次是整理。</p>
<p>收集主要想到有三种方式：</p>
<ul>
<li>找现成工具（无趣，暂不考虑）。</li>
<li>在<code>https://m.weibo.cn/u/14015127xxx</code> 页面一直按<code>END</code> 键，然后页面会不断异步发送请求以增加页面内容，直到全部内容都被获取。</li>
<li>可以看到第二种方法中的请求是向<code>https://m.weibo.cn/api/container/getIndex?type=uid&amp;value=1401527xxx&amp;containerid=1076031401527xxx&amp;page=1</code> 发送GET请求，只需迭代page的参数即可得到所有数据。</li>
</ul>
<h3 id="方法二实践"><a href="#方法二实践" class="headerlink" title="方法二实践"></a>方法二实践</h3><p>用如下简单脚本模拟按键行为，泡杯茶观察成果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> win32api</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">print</span> time.asctime()</div><div class="line">cnt=<span class="number">0</span></div><div class="line"><span class="keyword">while</span> <span class="number">1</span>:</div><div class="line">	cnt+=<span class="number">1</span></div><div class="line">	win32api.keybd_event(<span class="number">35</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>) <span class="comment">#35 stands for "END" key; 0 means hold down</span></div><div class="line"> 	win32api.keybd_event(<span class="number">35</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>) <span class="comment"># 1 means hold up </span></div><div class="line">	<span class="keyword">print</span> cnt,</div><div class="line">	time.sleep(<span class="number">2</span>)</div><div class="line"><span class="keyword">print</span> time.asctime()</div></pre></td></tr></table></figure>
<p>发现按了几十下页面就开始不变化了，观察请求发现都是发给<code>page=50</code>的，想必是做了限制，最多获取50条记录，暂告失败。</p>
<h3 id="方法三实践"><a href="#方法三实践" class="headerlink" title="方法三实践"></a>方法三实践</h3><p>要用这个方法首先最好知道总共有多少page，用二分法手动测，很快就能发现目标用户共有1542个page的记录，然后写个脚本dump下这些响应，保存成json文件，以供后面处理即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> * </div><div class="line"><span class="keyword">from</span> time <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">print</span> asctime()</div><div class="line">url=<span class="string">"https://m.weibo.cn/api/container/getIndex?type=uid&amp;value=1401527xxx&amp;containerid=1076031401527xxx&amp;page="</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1543</span>,<span class="number">1</span>,<span class="number">-1</span>):</div><div class="line">	u=url+str(i)</div><div class="line">	f=open(<span class="string">"result/%d.json"</span>%i,<span class="string">'w+'</span>)</div><div class="line">	f.write(get(u).content)</div><div class="line">	f.close()</div><div class="line">	sleep(<span class="number">2</span>)</div><div class="line">	<span class="keyword">if</span> i%<span class="number">50</span>==<span class="number">0</span>:</div><div class="line">		sleep(<span class="number">3</span>)</div><div class="line"><span class="keyword">print</span> asctime()</div></pre></td></tr></table></figure>
<h3 id="处理json"><a href="#处理json" class="headerlink" title="处理json"></a>处理json</h3><p>分析响应结构，提取关键信息，构造文件汇总即可。代码见  <a href="https://github.com/findneo/TKposts/blob/master/parse_json.py" target="_blank" rel="external">GitHub</a> 。</p>
<h3 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h3><ul>
<li>了解了正则表达式的<code>backreference</code>和<code>lazy mode</code> 。</li>
<li>使用 <code>json.load(file)</code> 将json文件转换成字典。</li>
<li>数据编码问题可能导致写文件报错，可用<code>f.write(data.encode(&#39;utf8&#39;))</code> 。</li>
<li>用<code>with open(&quot;f1&quot;) as f1,open(&quot;f2&quot;) as f2:</code> 打开多个文件。</li>
<li>每一个人作为数字公民的部分可能最后并不能留下太多痕迹，而且这些痕迹可能非常脆弱。当然，话说回来，这同线下生活也是相似的。</li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://findneo.github.io/2018/03/180309RetrieveWeiboPosts/" data-id="cjenqn7lj00080sgy0l511r4e" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJElEQVR42u3aUa7CMAwEQO5/6b4DoJbdpPDUZPKFUKCdfFi249crXsfbOtvzvj/5z/xXUwsDA+OxjONyje1JXvoakz8XAwNjH0YSQNs90eNj0od3xsDAwCgDYhIu7zo+DAwMjPxzHkbz0hcDAwOjLVCTv74Oqdff/6gWx8DAeCAj77r//vNX7jcwMDAexTjKlVw9Juld3nSL3goDA2NpxlghmiR2/1AYY2BgLMoYC7XzpWx7BB++wcDAWJqRpHozba98dOz6WREYAwNjUUbejm9b/2OMwQsADAyM7Rl5ETt2MdkyTruGGBgYGzDyca68uM3L17EBtfqeAQMD4+GMJCHLU8a8oM0Bp7/CwMBYmtG2+FtY2/pvjwADA2NPRhtS72r9t2niYIKIgYHxQMZMW3/s2uCuYYs6f8TAwHgsYyzgtg27/AjapttUaoiBgfEQRnsxmWPaK8mxSwUMDIwdGN9o6yeNtrbQjZqAGBgYGzDav5tJ/saOpp4cwcDAWI4Rbb0pjLYvGo1iYGBgbMZIVpvAtTvzUQwMDIzdGIOtrqEhifyJxcwIBgbGcoyZIJtfIbSH0qaqGBgYazPy1Rao+SBaUiS3TUAMDIz1GG2QvWt/XlTXJ42BgbEo467ANxaa2yIWAwMDI3/1vOnWZqP5AWFgYGDMhMt2nCK/wjwtYjEwMJZm5EMV+SVl3uGbKYwxMDB2YLSlYxsW21ZaXgBjYGBswPgD/pY39QjVf/YAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/python/">python</a></div><div class="post-nav"><a class="pre" href="/2018/03/180310N1CTF/">N1CTF baby_N1ES writeup</a><a class="next" href="/2018/03/180308-Newbie-Security-List/">网络安全学习资料</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/code/">code</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/writeup/">writeup</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/备忘/">备忘</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/奇技淫巧/">奇技淫巧</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/社区投稿/">社区投稿</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/code/" style="font-size: 15px;">code</a> <a href="/tags/命令注入/" style="font-size: 15px;">命令注入</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/ctf/" style="font-size: 15px;">ctf</a> <a href="/tags/hacklife/" style="font-size: 15px;">hacklife</a> <a href="/tags/resources/" style="font-size: 15px;">resources</a> <a href="/tags/Batch/" style="font-size: 15px;">Batch</a> <a href="/tags/C/" style="font-size: 15px;">C</a> <a href="/tags/sqli/" style="font-size: 15px;">sqli</a> <a href="/tags/密码学/" style="font-size: 15px;">密码学</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://chybeta.github.io/" title="Chybeta" target="_blank">Chybeta</a><ul></ul><a href="https://lxpark.com/" title="lzhtony" target="_blank">lzhtony</a><ul></ul><a href="https://madsome.cn/" title="Mads" target="_blank">Mads</a><ul></ul><a href="https://ph0en1x.com/" title="Ph0en1x ctf team" target="_blank">Ph0en1x ctf team</a><ul></ul><a href="http://vancir.com/" title="Vancir" target="_blank">Vancir</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">findneo.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = '//hm.baidu.com/hm.js?' + '46a32286256dd65996099e45157ca245';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>