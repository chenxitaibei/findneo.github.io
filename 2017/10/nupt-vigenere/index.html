<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Time is of the essence."><title>南邮CTF平台 Vigenere writeup | findneo</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">南邮CTF平台 Vigenere writeup</h1><a id="logo" href="/.">findneo</a><p class="description">Time is of the essence.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">南邮CTF平台 Vigenere writeup</h1><div class="post-meta">Oct 5, 2017<span> | </span><span class="category"><a href="/categories/writeup/">writeup</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#题目"><span class="toc-number">1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是异或"><span class="toc-number">2.</span> <span class="toc-text">什么是异或</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#概念"><span class="toc-number">3.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解题"><span class="toc-number">4.</span> <span class="toc-text">解题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#理解加密"><span class="toc-number">4.1.</span> <span class="toc-text">理解加密</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解密代码主程序"><span class="toc-number">4.2.</span> <span class="toc-text">解密代码主程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#确定密钥的长度和候选字符集"><span class="toc-number">4.3.</span> <span class="toc-text">确定密钥的长度和候选字符集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#遍历候选字符集，求出对应的字频"><span class="toc-number">4.4.</span> <span class="toc-text">遍历候选字符集，求出对应的字频</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#根据字频求得密钥"><span class="toc-number">4.5.</span> <span class="toc-text">根据字频求得密钥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#根据密钥解密"><span class="toc-number">4.6.</span> <span class="toc-text">根据密钥解密</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一些数据"><span class="toc-number">5.</span> <span class="toc-text">一些数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#可能的密钥长度和对应字符集"><span class="toc-number">5.1.</span> <span class="toc-text">可能的密钥长度和对应字符集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#最后结果"><span class="toc-number">5.2.</span> <span class="toc-text">最后结果</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解密代码全文"><span class="toc-number">6.</span> <span class="toc-text">解密代码全文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#题目备份"><span class="toc-number">7.</span> <span class="toc-text">题目备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考链接"><span class="toc-number">8.</span> <span class="toc-text">参考链接</span></a></li></ol></div></div><div class="post-content"><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><blockquote>
<p> It is said that Vigenere cipher does not achieve the perfect secrecy actually :-)</p>
<p> Tips:<br> 1.The encode pragram is given;<br> 2.Do u no <a href="https://en.wikipedia.org/wiki/Index_of_coincidence" target="_blank" rel="external">index of coincidence </a>？<br> 3.The key is last 6 words of the plain text(with “nctf{}” when submitted, also without any interpunction)</p>
<p> <a href="http://ctf.nuptsast.com/static/uploads/13706e3281c1fb0c04417d3452cb745b/encode.cpp" target="_blank" rel="external">encode.cpp</a>   <a href="http://ctf.nuptsast.com/static/uploads/9a27a6c8b9fb7b8d2a07ad94924c02e5/code.txt" target="_blank" rel="external">code.txt</a> </p>
</blockquote>
<h3 id="什么是异或"><a href="#什么是异或" class="headerlink" title="什么是异或"></a>什么是异或</h3><p>异或（exclusive or）是二元逻辑运算符，符号为 XOR 或 EOR 或 ⊕或 ^ 。对于表达式 <code>a^b</code> 的取值，当且仅当a、b逻辑值不同时为真。具体来说就是四个式子：<code>1^1=0;    0^0=0;    1^0=1;    0^1=1</code> 。另外，异或有一些基本的特性，<strong>本题仅用到第七行的特性</strong>即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">a^a=<span class="number">0</span>;</div><div class="line">a^<span class="number">0</span>=a;</div><div class="line">a^b=b^a;</div><div class="line">a^(b^c)=(a^b)^c;</div><div class="line">a^b^b=a;</div><div class="line">------------------------------------------</div><div class="line">如果 cipher = plain ^ key，那么 plain = cipher ^ key</div><div class="line">简单地证明一下：</div><div class="line">	        c = p ^ k</div><div class="line"> --&gt;  	c ^ k = p ^ k ^ k</div><div class="line"> --&gt;  	c ^ k = p</div><div class="line">------------------------------------------</div><div class="line">一个以字节为单位进行异或的例子：</div><div class="line">  <span class="number">97</span>^<span class="number">98</span>	--&gt; <span class="number">01100001</span> ^ <span class="number">01100010</span> = <span class="number">00000011</span> -&gt; <span class="number">3</span></div></pre></td></tr></table></figure>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>我们知道，英文中的每个字母使用频率是不同的，在够长的一段话里，各个字母的占比大致稳定，并且这个稳定值也已经用巨大的语料库统计出来了，这就是<a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E6%AF%8D%E9%A2%91%E7%8E%87" target="_blank" rel="external">字母频率</a>。这种统计层面的现象，就给我们提供了判断一段文字是否可能有意义的依据，并且这种判断可以通过编程轻松完成。然而，给定两个字母组合，只计算出其中各字母的占比是不够的，想要准确高效地比较两段文字谁更可能具备有意义的语义，我们最好算出一个归一化参数，用以直观表示可能性的大小，这就是文中提到的 <a href="https://en.wikipedia.org/wiki/Index_of_coincidence#Example" target="_blank" rel="external">correlation</a>  ，计算公式也是有的，<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/1b77b0ca8571bb219a9ad2ddf00b982d983d17d3" alt="\mathbf{\chi} = \sum_{i=1}^{c}n_i f_i">  ，其中n(i)指字母i在一段话的所有字母中所占的比例，f(i)就是已经统计出来的i字母的频率，具体如下所示。</p>
<p>字母频率列表：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">frequencies = &#123;<span class="string">"e"</span>: <span class="number">0.12702</span>, <span class="string">"t"</span>: <span class="number">0.09056</span>, <span class="string">"a"</span>: <span class="number">0.08167</span>, <span class="string">"o"</span>: <span class="number">0.07507</span>, <span class="string">"i"</span>: <span class="number">0.06966</span>,</div><div class="line">               <span class="string">"n"</span>: <span class="number">0.06749</span>, <span class="string">"s"</span>: <span class="number">0.06327</span>, <span class="string">"h"</span>: <span class="number">0.06094</span>, <span class="string">"r"</span>: <span class="number">0.05987</span>, <span class="string">"d"</span>: <span class="number">0.04253</span>,</div><div class="line">               <span class="string">"l"</span>: <span class="number">0.04025</span>, <span class="string">"c"</span>: <span class="number">0.02782</span>, <span class="string">"u"</span>: <span class="number">0.02758</span>, <span class="string">"m"</span>: <span class="number">0.02406</span>, <span class="string">"w"</span>: <span class="number">0.02360</span>,</div><div class="line">               <span class="string">"f"</span>: <span class="number">0.02228</span>, <span class="string">"g"</span>: <span class="number">0.02015</span>, <span class="string">"y"</span>: <span class="number">0.01974</span>, <span class="string">"p"</span>: <span class="number">0.01929</span>, <span class="string">"b"</span>: <span class="number">0.01492</span>,</div><div class="line">               <span class="string">"v"</span>: <span class="number">0.00978</span>, <span class="string">"k"</span>: <span class="number">0.00772</span>, <span class="string">"j"</span>: <span class="number">0.00153</span>, <span class="string">"x"</span>: <span class="number">0.00150</span>, <span class="string">"q"</span>: <span class="number">0.00095</span>,</div><div class="line">               <span class="string">"z"</span>: <span class="number">0.00074</span>&#125;</div></pre></td></tr></table></figure>
<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><h4 id="理解加密"><a href="#理解加密" class="headerlink" title="理解加密"></a>理解加密</h4><p>题目的加密方式大致等价于这样写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># coding:utf8</span></div><div class="line">key = [<span class="number">0xba</span>, <span class="number">0x1f</span>, <span class="number">0x91</span>, <span class="number">0xb2</span>, <span class="number">0x53</span>, <span class="number">0xcd</span>, <span class="number">0x3e</span>]  <span class="comment"># 长度范围是1-13，当然，我们还不知道key是多少</span></div><div class="line">plain = open(<span class="string">'ptext.txt'</span>).read()</div><div class="line">cipher = open(<span class="string">'ctext.txt'</span>, <span class="string">'w+'</span>)</div><div class="line">c = <span class="string">''</span></div><div class="line">k = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> p <span class="keyword">in</span> plain:</div><div class="line">    c += hex(ord(p) ^ key[k])[<span class="number">2</span>:].zfill(<span class="number">2</span>)</div><div class="line">    k = (k + <span class="number">1</span>) % len(key)</div><div class="line">cipher.write(c)</div></pre></td></tr></table></figure>
<p>程序意思是将明文和密钥逐字节异或，每次异或后的值用两位十六进制表示写入文件，也就是我们见到的code.txt，在这个过程中，密钥是循环使用的。</p>
<p>那么现在情况是这样的，我们知道：</p>
<blockquote>
<p> 密钥的长度区间为1-13字节</p>
<p> 加密方式为逐字节循环异或 </p>
<p> 加密结果，即密文的完整内容</p>
</blockquote>
<p>我们想知道</p>
<blockquote>
<p>明文内容 </p>
<p>密钥内容</p>
</blockquote>
<p>(⊙﹏⊙) 这看起来有点困难。</p>
<p>不过，其实还有两个不言而喻但非常重要的信息</p>
<blockquote>
<p>明文的每一个字节都是可见字符。</p>
<p>明文是一段有意义的话。</p>
</blockquote>
<h4 id="解密代码主程序"><a href="#解密代码主程序" class="headerlink" title="解密代码主程序"></a>解密代码主程序</h4><p>先放个主程序，和下面的对照着看。全部代码在<a href="#解密代码全文">文章底部</a> 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    ps = []</div><div class="line">    ks = []</div><div class="line">    ss = []</div><div class="line">    ps.extend(xrange(<span class="number">32</span>, <span class="number">127</span>))</div><div class="line">    ks.extend(xrange(<span class="number">0xff</span> + <span class="number">1</span>))</div><div class="line">    ss.extend(xrange(<span class="number">1</span>, <span class="number">14</span>))</div><div class="line">    cipher = getCipher()</div><div class="line"></div><div class="line">    keyPool = getKeyPool(cipher=cipher, stepSet=ss, plainSet=ps, keySet=ks)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> keyPool:</div><div class="line">        freq = getFrequency(cipher, keyPool[i])</div><div class="line">        key = analyseFrequency(freq)</div><div class="line">        plain = vigenereDecrypt(cipher, key)</div><div class="line">        <span class="keyword">print</span> key, plain</div></pre></td></tr></table></figure>
<h4 id="确定密钥的长度和候选字符集"><a href="#确定密钥的长度和候选字符集" class="headerlink" title="确定密钥的长度和候选字符集"></a>确定密钥的长度和候选字符集</h4><p>明文由可见字符组成。这意味着任何一个使明文出现不可见字符的值都不可能出现在key里。<br>依据此可以取得两个进展。</p>
<ol>
<li>求出key的每一个字节有哪些候选字符。<br>具体操作：<br>当我们假设某一字节的key的值时，就可以使用前文提到的plain = cipher ^ key 求出这一字节密文对应的明文，如果这个明文是不可见的，那么我们假设的这个值就不可能出现在key的这个字节。<br>因为是循环异或，所以每个字节的key会去加密多个字节的明文，我们就可以如法炮制，大大缩小key的每个字节的候选字符集。</li>
<li>在1的基础上，确定key可能有哪几种长度。<br>具体操作：<br>我们假设key每一种可能的长度，一一去求对应的候选字符集， 如果有一种长度的key在某一字节的候选字符集为空，那么key就不可能是这个长度。</li>
</ol>
<p>至此，我们可以从无到有求得  <strong>key有哪些可能的长度</strong> 以及  <strong>key在每一种长度下对应的每个字节的候选字符集 </strong>。</p>
<p>上代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKeyPool</span><span class="params">(cipher, stepSet, plainSet, keySet)</span>:</span></div><div class="line">    <span class="string">''' 传入的密文串、明文字符集、密钥字符集、密钥长度范围均作为数字列表处理.形如[0x11,0x22,0x33]</span></div><div class="line"><span class="string">        返回一个字典，以可能的密钥长度为键，以对应的每一字节的密钥字符集构成的列表为值，</span></div><div class="line"><span class="string">        密钥字符集为数字列表。</span></div><div class="line"><span class="string">            形如&#123;</span></div><div class="line"><span class="string">                    1:[[0x11]],</span></div><div class="line"><span class="string">                    3:[</span></div><div class="line"><span class="string">                        [0x11,0x33,0x46],</span></div><div class="line"><span class="string">                        [0x22,0x58],</span></div><div class="line"><span class="string">                        [0x33]</span></div><div class="line"><span class="string">                       ]</span></div><div class="line"><span class="string">                &#125;</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    keyPool = dict()</div><div class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> stepSet:</div><div class="line">        maybe = [<span class="keyword">None</span>] * step</div><div class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> xrange(step):</div><div class="line">            maybe[pos] = []</div><div class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> keySet:</div><div class="line">                flag = <span class="number">1</span></div><div class="line">                <span class="keyword">for</span> c <span class="keyword">in</span> cipher[pos::step]:</div><div class="line">                    <span class="keyword">if</span> c ^ k <span class="keyword">not</span> <span class="keyword">in</span> plainSet:</div><div class="line">                        flag = <span class="number">0</span></div><div class="line">                <span class="keyword">if</span> flag:</div><div class="line">                    maybe[pos].append(k)</div><div class="line">        <span class="keyword">for</span> posPool <span class="keyword">in</span> maybe:</div><div class="line">            <span class="keyword">if</span> len(posPool) == <span class="number">0</span>:</div><div class="line">                maybe = []</div><div class="line">                <span class="keyword">break</span></div><div class="line">        <span class="keyword">if</span> len(maybe) != <span class="number">0</span>:</div><div class="line">            keyPool[step] = maybe</div><div class="line">    <span class="keyword">return</span> keyPool</div></pre></td></tr></table></figure>
<h4 id="遍历候选字符集，求出对应的字频"><a href="#遍历候选字符集，求出对应的字频" class="headerlink" title="遍历候选字符集，求出对应的字频"></a>遍历候选字符集，求出对应的字频</h4><p>这虽是个体力活，却也得小心翼翼。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFrequency</span><span class="params">(cipher, keyPoolList)</span>:</span></div><div class="line">    <span class="string">''' 传入的密文作为数字列表处理</span></div><div class="line"><span class="string">        传入密钥的字符集应为列表，依次包含各字节字符集。</span></div><div class="line"><span class="string">            形如[[0x11,0x12],[0x22]]</span></div><div class="line"><span class="string">        返回字频列表，依次为各字节字符集中每一字符作为密钥组成部分时对应的明文字频</span></div><div class="line"><span class="string">            形如[&#123;</span></div><div class="line"><span class="string">                    0x11:&#123;'a':2,'b':3&#125;,</span></div><div class="line"><span class="string">                    0x12:&#123;'e':6&#125;</span></div><div class="line"><span class="string">                 &#125;,</span></div><div class="line"><span class="string">                 &#123;</span></div><div class="line"><span class="string">                    0x22:&#123;'g':1&#125;</span></div><div class="line"><span class="string">                 &#125;]</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    freqList = []</div><div class="line">    keyLen = len(keyPoolList)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(keyLen):</div><div class="line">        posFreq = dict()</div><div class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> keyPoolList[i]:</div><div class="line">            posFreq[k] = dict()</div><div class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> cipher[i::keyLen]:</div><div class="line">                p = chr(k ^ c)</div><div class="line">                posFreq[k][p] = posFreq[k][p] + <span class="number">1</span> <span class="keyword">if</span> p <span class="keyword">in</span> posFreq[k] <span class="keyword">else</span> <span class="number">1</span></div><div class="line">        freqList.append(posFreq)</div><div class="line">    <span class="keyword">return</span> freqList</div></pre></td></tr></table></figure>
<h4 id="根据字频求得密钥"><a href="#根据字频求得密钥" class="headerlink" title="根据字频求得密钥"></a>根据字频求得密钥</h4><p>明文是一段有意义的话。这意味着它算出来的correlation值一定是所有候选明文中最大的，依照这一点就能挑出密钥每个字节的值，从而得到整个密钥。这也是整个解密过程最核心的一部分。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">calCorrelation</span><span class="params">(cpool)</span>:</span></div><div class="line">    <span class="string">'''传入字典，形如&#123;'e':2,'p':3&#125;</span></div><div class="line"><span class="string">        返回可能性，0~1,值越大可能性越大</span></div><div class="line"><span class="string">        (correlation between the decrypted column letter frequencies and</span></div><div class="line"><span class="string">        the relative letter frequencies for normal English text)</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    frequencies = &#123;<span class="string">"e"</span>: <span class="number">0.12702</span>, <span class="string">"t"</span>: <span class="number">0.09056</span>, <span class="string">"a"</span>: <span class="number">0.08167</span>, <span class="string">"o"</span>: <span class="number">0.07507</span>, <span class="string">"i"</span>: <span class="number">0.06966</span>,</div><div class="line">                   <span class="string">"n"</span>: <span class="number">0.06749</span>, <span class="string">"s"</span>: <span class="number">0.06327</span>, <span class="string">"h"</span>: <span class="number">0.06094</span>, <span class="string">"r"</span>: <span class="number">0.05987</span>, <span class="string">"d"</span>: <span class="number">0.04253</span>,</div><div class="line">                   <span class="string">"l"</span>: <span class="number">0.04025</span>, <span class="string">"c"</span>: <span class="number">0.02782</span>, <span class="string">"u"</span>: <span class="number">0.02758</span>, <span class="string">"m"</span>: <span class="number">0.02406</span>, <span class="string">"w"</span>: <span class="number">0.02360</span>,</div><div class="line">                   <span class="string">"f"</span>: <span class="number">0.02228</span>, <span class="string">"g"</span>: <span class="number">0.02015</span>, <span class="string">"y"</span>: <span class="number">0.01974</span>, <span class="string">"p"</span>: <span class="number">0.01929</span>, <span class="string">"b"</span>: <span class="number">0.01492</span>,</div><div class="line">                   <span class="string">"v"</span>: <span class="number">0.00978</span>, <span class="string">"k"</span>: <span class="number">0.00772</span>, <span class="string">"j"</span>: <span class="number">0.00153</span>, <span class="string">"x"</span>: <span class="number">0.00150</span>, <span class="string">"q"</span>: <span class="number">0.00095</span>,</div><div class="line">                   <span class="string">"z"</span>: <span class="number">0.00074</span>&#125;</div><div class="line">    relative = <span class="number">0.0</span></div><div class="line">    total = <span class="number">0</span></div><div class="line">    fpool = <span class="string">'etaoinshrdlcumwfgypbvkjxqz'</span></div><div class="line">    total = sum(cpool.values())  <span class="comment"># 总和应包括字母和其他可见字符</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cpool.keys():</div><div class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> fpool:</div><div class="line">            relative += frequencies[i] * cpool[i] / total</div><div class="line">    <span class="keyword">return</span> relative</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">analyseFrequency</span><span class="params">(cfreq)</span>:</span></div><div class="line">    key = []</div><div class="line">    <span class="keyword">for</span> posFreq <span class="keyword">in</span> cfreq:</div><div class="line">        mostRelative = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> keyChr <span class="keyword">in</span> posFreq.keys():</div><div class="line">            r = calCorrelation(posFreq[keyChr])</div><div class="line">            <span class="keyword">if</span> r &gt; mostRelative:</div><div class="line">                mostRelative = r</div><div class="line">                keychar = keyChr</div><div class="line">        key.append(keychar)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> key</div></pre></td></tr></table></figure>
<h4 id="根据密钥解密"><a href="#根据密钥解密" class="headerlink" title="根据密钥解密"></a>根据密钥解密</h4><p>求出密钥剩下的就好办了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">vigenereDecrypt</span><span class="params">(cipher, key)</span>:</span></div><div class="line">    plain = <span class="string">''</span></div><div class="line">    cur = <span class="number">0</span></div><div class="line">    ll = len(key)</div><div class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> cipher:</div><div class="line">        plain += chr(c ^ key[cur])</div><div class="line">        cur = (cur + <span class="number">1</span>) % ll</div><div class="line">    <span class="keyword">return</span> plain</div></pre></td></tr></table></figure>
<h3 id="一些数据"><a href="#一些数据" class="headerlink" title="一些数据"></a>一些数据</h3><h4 id="可能的密钥长度和对应字符集"><a href="#可能的密钥长度和对应字符集" class="headerlink" title="可能的密钥长度和对应字符集"></a>可能的密钥长度和对应字符集</h4><figure class="highlight clojure"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="number">7</span>: </div><div class="line">[[<span class="number">162</span>, <span class="number">165</span>, <span class="number">168</span>, <span class="number">169</span>, <span class="number">170</span>, <span class="number">174</span>, <span class="number">175</span>, <span class="number">178</span>, <span class="number">179</span>, <span class="number">180</span>, <span class="number">184</span>, <span class="number">185</span>, <span class="number">186</span>, <span class="number">187</span>, <span class="number">189</span>, <span class="number">190</span>, <span class="number">191</span>], </div><div class="line"></div><div class="line">[<span class="number">0</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">21</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">68</span>, <span class="number">69</span>, <span class="number">70</span>, <span class="number">71</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">77</span>, <span class="number">79</span>, <span class="number">80</span>, <span class="number">81</span>, <span class="number">82</span>, <span class="number">83</span>, <span class="number">84</span>, <span class="number">85</span>, <span class="number">86</span>, <span class="number">87</span>, <span class="number">88</span>, <span class="number">89</span>, <span class="number">90</span>, <span class="number">91</span>, <span class="number">92</span>, <span class="number">93</span>, <span class="number">94</span>, <span class="number">95</span>], </div><div class="line"></div><div class="line">[<span class="number">132</span>, <span class="number">133</span>, <span class="number">142</span>, <span class="number">144</span>, <span class="number">145</span>, <span class="number">146</span>, <span class="number">147</span>, <span class="number">148</span>, <span class="number">149</span>, <span class="number">150</span>, <span class="number">155</span>, <span class="number">159</span>, <span class="number">192</span>, <span class="number">193</span>, <span class="number">194</span>, <span class="number">195</span>, <span class="number">196</span>, <span class="number">197</span>, <span class="number">198</span>, <span class="number">199</span>, <span class="number">200</span>, <span class="number">201</span>, <span class="number">202</span>, <span class="number">203</span>, <span class="number">204</span>, <span class="number">205</span>, <span class="number">207</span>, <span class="number">208</span>, <span class="number">209</span>, <span class="number">210</span>, <span class="number">211</span>, <span class="number">212</span>, <span class="number">213</span>, <span class="number">214</span>, <span class="number">215</span>, <span class="number">216</span>, <span class="number">217</span>, <span class="number">218</span>, <span class="number">219</span>, <span class="number">220</span>, <span class="number">221</span>, <span class="number">222</span>, <span class="number">223</span>], </div><div class="line"></div><div class="line">[<span class="number">161</span>, <span class="number">166</span>, <span class="number">167</span>, <span class="number">170</span>, <span class="number">173</span>, <span class="number">176</span>, <span class="number">177</span>, <span class="number">178</span>, <span class="number">179</span>, <span class="number">180</span>, <span class="number">181</span>, <span class="number">182</span>, <span class="number">183</span>, <span class="number">186</span>, <span class="number">188</span>], </div><div class="line"></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">68</span>, <span class="number">70</span>, <span class="number">72</span>, <span class="number">76</span>, <span class="number">78</span>, <span class="number">80</span>, <span class="number">81</span>, <span class="number">82</span>, <span class="number">83</span>, <span class="number">84</span>, <span class="number">86</span>, <span class="number">87</span>, <span class="number">90</span>, <span class="number">93</span>], </div><div class="line"></div><div class="line">[<span class="number">128</span>, <span class="number">129</span>, <span class="number">130</span>, <span class="number">131</span>, <span class="number">132</span>, <span class="number">133</span>, <span class="number">134</span>, <span class="number">135</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">138</span>, <span class="number">139</span>, <span class="number">140</span>, <span class="number">141</span>, <span class="number">142</span>, <span class="number">143</span>, <span class="number">144</span>, <span class="number">145</span>, <span class="number">147</span>, <span class="number">148</span>, <span class="number">149</span>, <span class="number">150</span>, <span class="number">151</span>, <span class="number">152</span>, <span class="number">153</span>, <span class="number">154</span>, <span class="number">155</span>, <span class="number">156</span>, <span class="number">157</span>, <span class="number">158</span>, <span class="number">159</span>, <span class="number">195</span>, <span class="number">196</span>, <span class="number">200</span>, <span class="number">201</span>, <span class="number">202</span>, <span class="number">204</span>, <span class="number">205</span>, <span class="number">206</span>, <span class="number">207</span>, <span class="number">208</span>, <span class="number">210</span>, <span class="number">213</span>, <span class="number">216</span>, <span class="number">217</span>, <span class="number">223</span>], </div><div class="line"></div><div class="line">[<span class="number">33</span>, <span class="number">39</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">52</span>, <span class="number">55</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">62</span>, <span class="number">63</span>]</div><div class="line">]&#125;</div></pre></td></tr></table></figure>
<h4 id="最后结果"><a href="#最后结果" class="headerlink" title="最后结果"></a>最后结果</h4><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[<span class="number">186</span>, <span class="number">31</span>, <span class="number">145</span>, <span class="number">178</span>, <span class="number">83</span>, <span class="number">205</span>, <span class="number">62</span>] Cryptography <span class="keyword">is</span> <span class="keyword">the</span> practice <span class="keyword">and</span> study <span class="keyword">of</span> techniques <span class="keyword">for</span>, among other things, secure communication <span class="keyword">in</span> <span class="keyword">the</span> presence <span class="keyword">of</span> attackers. Cryptography has been used <span class="keyword">for</span> hundreds, <span class="keyword">if</span> <span class="keyword">not</span> thousands, <span class="keyword">of</span> years, <span class="keyword">but</span> traditional cryptosystems were designed <span class="keyword">and</span> evaluated <span class="keyword">in</span> a fairly ad hoc manner. For example, <span class="keyword">the</span> Vigenere encryption scheme was thought <span class="keyword">to</span> be secure <span class="keyword">for</span> decades <span class="keyword">after</span> <span class="keyword">it</span> was invented, <span class="keyword">but</span> we now know, <span class="keyword">and</span> this exercise demonstrates, <span class="keyword">that</span> <span class="keyword">it</span> can be broken very easily.</div><div class="line">[Finished <span class="keyword">in</span> <span class="number">2.2</span>s]</div></pre></td></tr></table></figure>
<h3 id="解密代码全文"><a href="#解密代码全文" class="headerlink" title="解密代码全文"></a>解密代码全文</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># coding:utf8</span></div><div class="line"><span class="comment"># by https://findneo.github.io/</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCipher</span><span class="params">(file=<span class="string">'code.txt'</span>)</span>:</span></div><div class="line">    <span class="string">'''从文件中读取十六进制串，返回十六进制数组</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    c = open(file).read()</div><div class="line">    codeintlist = []</div><div class="line">    codeintlist.extend(</div><div class="line">        (map(<span class="keyword">lambda</span> i: int(c[i:i + <span class="number">2</span>], <span class="number">16</span>), range(<span class="number">0</span>, len(c), <span class="number">2</span>))))</div><div class="line">    <span class="keyword">return</span> codeintlist</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKeyPool</span><span class="params">(cipher, stepSet, plainSet, keySet)</span>:</span></div><div class="line">    <span class="string">''' 传入的密文串、明文字符集、密钥字符集、密钥长度范围均作为数字列表处理.形如[0x11,0x22,0x33]</span></div><div class="line"><span class="string">        返回一个字典，以可能的密钥长度为键，以对应的每一字节的密钥字符集构成的列表为值，密钥字符集为数字列表。</span></div><div class="line"><span class="string">            形如&#123;</span></div><div class="line"><span class="string">                    1:[[0x11]],</span></div><div class="line"><span class="string">                    3:[</span></div><div class="line"><span class="string">                        [0x11,0x33,0x46],</span></div><div class="line"><span class="string">                        [0x22,0x58],</span></div><div class="line"><span class="string">                        [0x33]</span></div><div class="line"><span class="string">                       ]</span></div><div class="line"><span class="string">                &#125;</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    keyPool = dict()</div><div class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> stepSet:</div><div class="line">        maybe = [<span class="keyword">None</span>] * step</div><div class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> xrange(step):</div><div class="line">            maybe[pos] = []</div><div class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> keySet:</div><div class="line">                flag = <span class="number">1</span></div><div class="line">                <span class="keyword">for</span> c <span class="keyword">in</span> cipher[pos::step]:</div><div class="line">                    <span class="keyword">if</span> c ^ k <span class="keyword">not</span> <span class="keyword">in</span> plainSet:</div><div class="line">                        flag = <span class="number">0</span></div><div class="line">                <span class="keyword">if</span> flag:</div><div class="line">                    maybe[pos].append(k)</div><div class="line">        <span class="keyword">for</span> posPool <span class="keyword">in</span> maybe:</div><div class="line">            <span class="keyword">if</span> len(posPool) == <span class="number">0</span>:</div><div class="line">                maybe = []</div><div class="line">                <span class="keyword">break</span></div><div class="line">        <span class="keyword">if</span> len(maybe) != <span class="number">0</span>:</div><div class="line">            keyPool[step] = maybe</div><div class="line">    <span class="keyword">return</span> keyPool</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">calCorrelation</span><span class="params">(cpool)</span>:</span></div><div class="line">    <span class="string">'''传入字典，形如&#123;'e':2,'p':3&#125;</span></div><div class="line"><span class="string">        返回可能性，0~1,值越大可能性越大</span></div><div class="line"><span class="string">        (correlation between the decrypted column letter frequencies and</span></div><div class="line"><span class="string">        the relative letter frequencies for normal English text)</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    frequencies = &#123;<span class="string">"e"</span>: <span class="number">0.12702</span>, <span class="string">"t"</span>: <span class="number">0.09056</span>, <span class="string">"a"</span>: <span class="number">0.08167</span>, <span class="string">"o"</span>: <span class="number">0.07507</span>, <span class="string">"i"</span>: <span class="number">0.06966</span>,</div><div class="line">                   <span class="string">"n"</span>: <span class="number">0.06749</span>, <span class="string">"s"</span>: <span class="number">0.06327</span>, <span class="string">"h"</span>: <span class="number">0.06094</span>, <span class="string">"r"</span>: <span class="number">0.05987</span>, <span class="string">"d"</span>: <span class="number">0.04253</span>,</div><div class="line">                   <span class="string">"l"</span>: <span class="number">0.04025</span>, <span class="string">"c"</span>: <span class="number">0.02782</span>, <span class="string">"u"</span>: <span class="number">0.02758</span>, <span class="string">"m"</span>: <span class="number">0.02406</span>, <span class="string">"w"</span>: <span class="number">0.02360</span>,</div><div class="line">                   <span class="string">"f"</span>: <span class="number">0.02228</span>, <span class="string">"g"</span>: <span class="number">0.02015</span>, <span class="string">"y"</span>: <span class="number">0.01974</span>, <span class="string">"p"</span>: <span class="number">0.01929</span>, <span class="string">"b"</span>: <span class="number">0.01492</span>,</div><div class="line">                   <span class="string">"v"</span>: <span class="number">0.00978</span>, <span class="string">"k"</span>: <span class="number">0.00772</span>, <span class="string">"j"</span>: <span class="number">0.00153</span>, <span class="string">"x"</span>: <span class="number">0.00150</span>, <span class="string">"q"</span>: <span class="number">0.00095</span>,</div><div class="line">                   <span class="string">"z"</span>: <span class="number">0.00074</span>&#125;</div><div class="line">    relative = <span class="number">0.0</span></div><div class="line">    total = <span class="number">0</span></div><div class="line">    fpool = <span class="string">'etaoinshrdlcumwfgypbvkjxqz'</span></div><div class="line">    total = sum(cpool.values())  <span class="comment"># 总和应包括字母和其他可见字符</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cpool.keys():</div><div class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> fpool:</div><div class="line">            relative += frequencies[i] * cpool[i] / total</div><div class="line">    <span class="keyword">return</span> relative</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">analyseFrequency</span><span class="params">(cfreq)</span>:</span></div><div class="line">    key = []</div><div class="line">    <span class="keyword">for</span> posFreq <span class="keyword">in</span> cfreq:</div><div class="line">        mostRelative = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> keyChr <span class="keyword">in</span> posFreq.keys():</div><div class="line">            r = calCorrelation(posFreq[keyChr])</div><div class="line">            <span class="keyword">if</span> r &gt; mostRelative:</div><div class="line">                mostRelative = r</div><div class="line">                keychar = keyChr</div><div class="line">        key.append(keychar)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> key</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFrequency</span><span class="params">(cipher, keyPoolList)</span>:</span></div><div class="line">    <span class="string">''' 传入的密文作为数字列表处理</span></div><div class="line"><span class="string">        传入密钥的字符集应为列表，依次包含各字节字符集。</span></div><div class="line"><span class="string">            形如[[0x11,0x12],[0x22]]</span></div><div class="line"><span class="string">        返回字频列表，依次为各字节字符集中每一字符作为密钥组成部分时对应的明文字频</span></div><div class="line"><span class="string">            形如[&#123;</span></div><div class="line"><span class="string">                    0x11:&#123;'a':2,'b':3&#125;,</span></div><div class="line"><span class="string">                    0x12:&#123;'e':6&#125;</span></div><div class="line"><span class="string">                 &#125;,</span></div><div class="line"><span class="string">                 &#123;</span></div><div class="line"><span class="string">                    0x22:&#123;'g':1&#125;</span></div><div class="line"><span class="string">                 &#125;]</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    freqList = []</div><div class="line">    keyLen = len(keyPoolList)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(keyLen):</div><div class="line">        posFreq = dict()</div><div class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> keyPoolList[i]:</div><div class="line">            posFreq[k] = dict()</div><div class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> cipher[i::keyLen]:</div><div class="line">                p = chr(k ^ c)</div><div class="line">                posFreq[k][p] = posFreq[k][p] + <span class="number">1</span> <span class="keyword">if</span> p <span class="keyword">in</span> posFreq[k] <span class="keyword">else</span> <span class="number">1</span></div><div class="line">        freqList.append(posFreq)</div><div class="line">    <span class="keyword">return</span> freqList</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">vigenereDecrypt</span><span class="params">(cipher, key)</span>:</span></div><div class="line">    plain = <span class="string">''</span></div><div class="line">    cur = <span class="number">0</span></div><div class="line">    ll = len(key)</div><div class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> cipher:</div><div class="line">        plain += chr(c ^ key[cur])</div><div class="line">        cur = (cur + <span class="number">1</span>) % ll</div><div class="line">    <span class="keyword">return</span> plain</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    ps = []</div><div class="line">    ks = []</div><div class="line">    ss = []</div><div class="line">    ps.extend(xrange(<span class="number">32</span>, <span class="number">127</span>))</div><div class="line">    ks.extend(xrange(<span class="number">0xff</span> + <span class="number">1</span>))</div><div class="line">    ss.extend(xrange(<span class="number">1</span>, <span class="number">14</span>))</div><div class="line">    cipher = getCipher()</div><div class="line"></div><div class="line">    keyPool = getKeyPool(cipher=cipher, stepSet=ss, plainSet=ps, keySet=ks)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> keyPool:</div><div class="line">        freq = getFrequency(cipher, keyPool[i])</div><div class="line">        key = analyseFrequency(freq)</div><div class="line">        plain = vigenereDecrypt(cipher, key)</div><div class="line">        <span class="keyword">print</span> key, plain</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<h3 id="题目备份"><a href="#题目备份" class="headerlink" title="题目备份"></a>题目备份</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">http:<span class="comment">//ctf.nuptsast.com/static/uploads/13706e3281c1fb0c04417d3452cb745b/encode.cpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> KEY_LENGTH 2 <span class="comment">// Can be anything from 1 to 13</span></span></div><div class="line"></div><div class="line">main()&#123;</div><div class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> ch;</div><div class="line">  FILE *fpIn, *fpOut;</div><div class="line">  <span class="keyword">int</span> i;</div><div class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> key[KEY_LENGTH] = &#123;<span class="number">0x00</span>, <span class="number">0x00</span>&#125;;</div><div class="line">  <span class="comment">/* of course, I did not use the all-0s key to encrypt */</span></div><div class="line"></div><div class="line">  fpIn = fopen(<span class="string">"ptext.txt"</span>, <span class="string">"r"</span>);</div><div class="line">  fpOut = fopen(<span class="string">"ctext.txt"</span>, <span class="string">"w"</span>);</div><div class="line"></div><div class="line">  i=<span class="number">0</span>;</div><div class="line">  <span class="keyword">while</span> (<span class="built_in">fscanf</span>(fpIn, <span class="string">"%c"</span>, &amp;ch) != EOF) &#123;</div><div class="line">    <span class="comment">/* avoid encrypting newline characters */</span>  </div><div class="line">    <span class="comment">/* In a "real-world" implementation of the Vigenere cipher, </span></div><div class="line"><span class="comment">       every ASCII character in the plaintext would be encrypted.</span></div><div class="line"><span class="comment">       However, I want to avoid encrypting newlines here because </span></div><div class="line"><span class="comment">       it makes recovering the plaintext slightly more difficult... */</span></div><div class="line">    <span class="comment">/* ...and my goal is not to create "production-quality" code =) */</span></div><div class="line">    <span class="keyword">if</span> (ch!=<span class="string">'\n'</span>) &#123;</div><div class="line">      <span class="built_in">fprintf</span>(fpOut, <span class="string">"%02X"</span>, ch ^ key[i % KEY_LENGTH]); <span class="comment">// ^ is logical XOR    </span></div><div class="line">      i++;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">  fclose(fpIn);</div><div class="line">  fclose(fpOut);</div><div class="line">  <span class="keyword">return</span>;</div><div class="line">&#125; </div><div class="line">----------------------------------------------------------------------------------</div><div class="line">http:<span class="comment">//ctf.nuptsast.com/static/uploads/9a27a6c8b9fb7b8d2a07ad94924c02e5/code.txt</span></div><div class="line"></div><div class="line">F96DE8C227A259C87EE1DA2AED57C93FE5DA36ED4EC87EF2C63AAE5B9A7EFFD673BE4ACF7BE8923CAB1ECE7AF2DA3DA44FCF7AE29235A24C963FF0DF3CA3599A70E5DA36BF1ECE77F8DC34BE129A6CF4D126BF5B9A7CFEDF3EB850D37CF0C63AA2509A76FF9227A55B9A6FE3D720A850D97AB1DD35ED5FCE6BF0D138A84CC931B1F121B44ECE70F6C032BD56C33FF9D320ED5CDF7AFF9226BE5BDE3FF7DD21ED56CF71F5C036A94D963FF8D473A351CE3FE5DA3CB84DDB71F5C17FED51DC3FE8D732BF4D963FF3C727ED4AC87EF5DB27A451D47EFD9230BF47CA6BFEC12ABE4ADF72E29224A84CDF3FF5D720A459D47AF59232A35A9A7AE7D33FB85FCE7AF5923AA31EDB3FF7D33ABF52C33FF0D673A551D93FFCD33DA35BC831B1F43CBF1EDF67F0DF23A15B963FE5DA36ED68D378F4DC36BF5B9A7AFFD121B44ECE76FEDC73BE5DD27AFCD773BA5FC93FE5DA3CB859D26BB1C63CED5CDF3FE2D730B84CDF3FF7DD21ED5ADF7CF0D636BE1EDB79E5D721ED57CE3FE6D320ED57D469F4DC27A85A963FF3C727ED49DF3FFFDD24ED55D470E69E73AC50DE3FE5DA3ABE1EDF67F4C030A44DDF3FF5D73EA250C96BE3D327A84D963FE5DA32B91ED36BB1D132A31ED87AB1D021A255DF71B1C436BF479A7AF0C13AA14794</div></pre></td></tr></table></figure>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ul>
<li><a href="https://en.wikipedia.org/wiki/Index_of_coincidence" target="_blank" rel="external">https://en.wikipedia.org/wiki/Index_of_coincidence</a></li>
<li><a href="https://en.wikipedia.org/wiki/One-time_pad" target="_blank" rel="external">https://en.wikipedia.org/wiki/One-time_pad</a></li>
<li><a href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher" target="_blank" rel="external">https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher</a></li>
<li><a href="https://en.wikipedia.org/wiki/Letter_frequency" target="_blank" rel="external">https://en.wikipedia.org/wiki/Letter_frequency</a></li>
<li><a href="https://www.lijinma.com/blog/2014/05/29/amazing-xor/" target="_blank" rel="external">https://www.lijinma.com/blog/2014/05/29/amazing-xor/</a></li>
<li><a href="http://blog.csdn.net/qq_31344951/article/details/77934717" target="_blank" rel="external">http://blog.csdn.net/qq_31344951/article/details/77934717</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://findneo.tech/2017/10/nupt-vigenere/" data-id="cjeqx25hs001aswgy1jx55tua" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABwUlEQVR42u3aSZLCMAwFUO5/6fQFsOtLHoCu5xUFJH7JQqXBr1e8nsGq/jr6ZvPCxcVd5j7TlW852n7+YLkBFxf3PjfZZn7V6P/565gbcHFxv5mbJyjVR8LFxf0f3BHoRHqEi4t7n1tNQaqtjV5jBRcX91PcfLNzn4/0d3FxcVvcp7iSlGW9PTrcHRcX9wo3DyjVQem8NFrZFxcX9zS3OiDpFTZRs2N6twIOFxd3K7cXpJLmaZ4YRRkZLi7uYe7KTZMEKEl38mIJFxf3JreXfKy3X3svAhcX9zQ3KVfy1kYeyPLS6E3ExcXFvc5N0HnBk18bPSouLu5F7srxrPwBqq/mzb64uLhXuL3haLW8qYbFvHWLi4t7jpuEnl76ko9dC+NYXFzci9xCtIsTkWaRMw+IuLi4F7n5Qavkc++wV3kmjIuLe4W7clSrOiZp/gcXF/cw9ymuPNFZH8ng4uJ+irveAF0JcNUhDS4u7k1udbyaFz/V4euGRAcXF3crtxeGVpKhDbUaLi7u13Cr45P10ImLi/tb3N5AJS+ZoskPLi7uMe7KSc9ec6TZUsHFxb3CzRume4co85e1ob+Li4vb4f4Bb9KaeaCPoQcAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/ctf/">ctf</a><a href="/tags/密码学/">密码学</a></div><div class="post-nav"><a class="pre" href="/2017/10/2017-miac-writeup/">2017 MIAC移动安全赛</a><a class="next" href="/2017/10/nupt-zonghe2/">南邮CTF平台综合题2writeup</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/code/">code</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/writeup/">writeup</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/备忘/">备忘</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/奇技淫巧/">奇技淫巧</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/社区投稿/">社区投稿</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/ctf/" style="font-size: 15px;">ctf</a> <a href="/tags/命令注入/" style="font-size: 15px;">命令注入</a> <a href="/tags/C/" style="font-size: 15px;">C</a> <a href="/tags/resources/" style="font-size: 15px;">resources</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/hacklife/" style="font-size: 15px;">hacklife</a> <a href="/tags/code/" style="font-size: 15px;">code</a> <a href="/tags/Batch/" style="font-size: 15px;">Batch</a> <a href="/tags/密码学/" style="font-size: 15px;">密码学</a> <a href="/tags/sqli/" style="font-size: 15px;">sqli</a> <a href="/tags/网络/" style="font-size: 15px;">网络</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://chybeta.github.io/" title="Chybeta" target="_blank">Chybeta</a><ul></ul><a href="https://lxpark.com/" title="lzhtony" target="_blank">lzhtony</a><ul></ul><a href="https://madsome.cn/" title="Mads" target="_blank">Mads</a><ul></ul><a href="https://ph0en1x.com/" title="Ph0en1x ctf team" target="_blank">Ph0en1x ctf team</a><ul></ul><a href="http://vancir.com/" title="Vancir" target="_blank">Vancir</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">findneo.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = '//hm.baidu.com/hm.js?' + '46a32286256dd65996099e45157ca245';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>