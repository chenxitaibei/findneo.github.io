<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="DIw_ok_t9Td1khsrivxwUFgeuh-vsLcA4tuqP4vJKI4" />








  <meta name="baidu-site-verification" content="811XNdrBmO" />







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/findneo-apple-touch-icon-next.ico?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/findneo-32x32.ico?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/findneo-16x16.ico?v=5.1.3">


  <link rel="mask-icon" href="/images/findneo-safari.ico?v=5.1.3" color="#222">





  <meta name="keywords" content="ctf,密码学," />





  <link rel="alternate" href="/atom.xml" title="findneo" type="application/atom+xml" />






<meta name="description" content="题目挺不错的，实打实，没脑洞，也锻炼了使用python的能力。">
<meta name="keywords" content="ctf,密码学">
<meta property="og:type" content="article">
<meta property="og:title" content="南邮CTF平台 Vigenere writeup">
<meta property="og:url" content="https://findneo.github.io/2017/10/nupt-vigenere/index.html">
<meta property="og:site_name" content="findneo">
<meta property="og:description" content="题目挺不错的，实打实，没脑洞，也锻炼了使用python的能力。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://wikimedia.org/api/rest_v1/media/math/render/svg/1b77b0ca8571bb219a9ad2ddf00b982d983d17d3">
<meta property="og:updated_time" content="2017-11-25T15:21:45.191Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="南邮CTF平台 Vigenere writeup">
<meta name="twitter:description" content="题目挺不错的，实打实，没脑洞，也锻炼了使用python的能力。">
<meta name="twitter:image" content="https://wikimedia.org/api/rest_v1/media/math/render/svg/1b77b0ca8571bb219a9ad2ddf00b982d983d17d3">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://findneo.github.io/2017/10/nupt-vigenere/"/>





  <title>南邮CTF平台 Vigenere writeup | findneo</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?46a32286256dd65996099e45157ca245";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">findneo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-留言">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            留言
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://findneo.github.io/2017/10/nupt-vigenere/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="findneo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.ico">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="findneo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">南邮CTF平台 Vigenere writeup</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-05T19:40:09+08:00">
                2017-10-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/writeup/" itemprop="url" rel="index">
                    <span itemprop="name">writeup</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/nupt-vigenere/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2017/10/nupt-vigenere/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          
              <div class="post-description">
                  题目挺不错的，实打实，没脑洞，也锻炼了使用python的能力。
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><blockquote>
<p> It is said that Vigenere cipher does not achieve the perfect secrecy actually :-)</p>
<p> Tips:<br> 1.The encode pragram is given;<br> 2.Do u no <a href="https://en.wikipedia.org/wiki/Index_of_coincidence" target="_blank" rel="external">index of coincidence </a>？<br> 3.The key is last 6 words of the plain text(with “nctf{}” when submitted, also without any interpunction)</p>
<p> <a href="http://ctf.nuptsast.com/static/uploads/13706e3281c1fb0c04417d3452cb745b/encode.cpp" target="_blank" rel="external">encode.cpp</a>   <a href="http://ctf.nuptsast.com/static/uploads/9a27a6c8b9fb7b8d2a07ad94924c02e5/code.txt" target="_blank" rel="external">code.txt</a> </p>
</blockquote>
<h3 id="什么是异或"><a href="#什么是异或" class="headerlink" title="什么是异或"></a>什么是异或</h3><p>异或（exclusive or）是二元逻辑运算符，符号为 XOR 或 EOR 或 ⊕或 ^ 。对于表达式 <code>a^b</code> 的取值，当且仅当a、b逻辑值不同时为真。具体来说就是四个式子：<code>1^1=0;    0^0=0;    1^0=1;    0^1=1</code> 。另外，异或有一些基本的特性，<strong>本题仅用到第七行的特性</strong>即可。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">a^a=<span class="number">0</span>;</div><div class="line">a^<span class="number">0</span>=a;</div><div class="line">a^b=b^a;</div><div class="line">a^(b^c)=(a^b)^c;</div><div class="line">a^b^b=a;</div><div class="line">------------------------------------------</div><div class="line">如果 cipher = plain ^ key，那么 plain = cipher ^ key</div><div class="line">简单地证明一下：</div><div class="line">	        c = p ^ k</div><div class="line"> --&gt;  	c ^ k = p ^ k ^ k</div><div class="line"> --&gt;  	c ^ k = p</div><div class="line">------------------------------------------</div><div class="line">一个以字节为单位进行异或的例子：</div><div class="line">  <span class="number">97</span>^<span class="number">98</span>	--&gt; <span class="number">01100001</span> ^ <span class="number">01100010</span> = <span class="number">00000011</span> -&gt; <span class="number">3</span></div></pre></td></tr></table></figure>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>我们知道，英文中的每个字母使用频率是不同的，在够长的一段话里，各个字母的占比大致稳定，并且这个稳定值也已经用巨大的语料库统计出来了，这就是<a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E6%AF%8D%E9%A2%91%E7%8E%87" target="_blank" rel="external">字母频率</a>。这种统计层面的现象，就给我们提供了判断一段文字是否可能有意义的依据，并且这种判断可以通过编程轻松完成。然而，给定两个字母组合，只计算出其中各字母的占比是不够的，想要准确高效地比较两段文字谁更可能具备有意义的语义，我们最好算出一个归一化参数，用以直观表示可能性的大小，这就是文中提到的 <a href="https://en.wikipedia.org/wiki/Index_of_coincidence#Example" target="_blank" rel="external">correlation</a>  ，计算公式也是有的，<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/1b77b0ca8571bb219a9ad2ddf00b982d983d17d3" alt="\mathbf{\chi} = \sum_{i=1}^{c}n_i f_i">  ，其中n(i)指字母i在一段话的所有字母中所占的比例，f(i)就是已经统计出来的i字母的频率，具体如下所示。</p>
<p>字母频率列表：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><div class="line">frequencies = &#123;<span class="string">"e"</span>: <span class="number">0.12702</span>, <span class="string">"t"</span>: <span class="number">0.09056</span>, <span class="string">"a"</span>: <span class="number">0.08167</span>, <span class="string">"o"</span>: <span class="number">0.07507</span>, <span class="string">"i"</span>: <span class="number">0.06966</span>,</div><div class="line">               <span class="string">"n"</span>: <span class="number">0.06749</span>, <span class="string">"s"</span>: <span class="number">0.06327</span>, <span class="string">"h"</span>: <span class="number">0.06094</span>, <span class="string">"r"</span>: <span class="number">0.05987</span>, <span class="string">"d"</span>: <span class="number">0.04253</span>,</div><div class="line">               <span class="string">"l"</span>: <span class="number">0.04025</span>, <span class="string">"c"</span>: <span class="number">0.02782</span>, <span class="string">"u"</span>: <span class="number">0.02758</span>, <span class="string">"m"</span>: <span class="number">0.02406</span>, <span class="string">"w"</span>: <span class="number">0.02360</span>,</div><div class="line">               <span class="string">"f"</span>: <span class="number">0.02228</span>, <span class="string">"g"</span>: <span class="number">0.02015</span>, <span class="string">"y"</span>: <span class="number">0.01974</span>, <span class="string">"p"</span>: <span class="number">0.01929</span>, <span class="string">"b"</span>: <span class="number">0.01492</span>,</div><div class="line">               <span class="string">"v"</span>: <span class="number">0.00978</span>, <span class="string">"k"</span>: <span class="number">0.00772</span>, <span class="string">"j"</span>: <span class="number">0.00153</span>, <span class="string">"x"</span>: <span class="number">0.00150</span>, <span class="string">"q"</span>: <span class="number">0.00095</span>,</div><div class="line">               <span class="string">"z"</span>: <span class="number">0.00074</span>&#125;</div></pre></td></tr></table></figure>
<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><h4 id="理解加密"><a href="#理解加密" class="headerlink" title="理解加密"></a>理解加密</h4><p>题目的加密方式大致等价于这样写：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment"># coding:utf8</span></div><div class="line">key = [<span class="number">0xba</span>, <span class="number">0x1f</span>, <span class="number">0x91</span>, <span class="number">0xb2</span>, <span class="number">0x53</span>, <span class="number">0xcd</span>, <span class="number">0x3e</span>]  <span class="comment"># 长度范围是1-13，当然，我们还不知道key是多少</span></div><div class="line">plain = open(<span class="string">'ptext.txt'</span>).read()</div><div class="line">cipher = open(<span class="string">'ctext.txt'</span>, <span class="string">'w+'</span>)</div><div class="line">c = <span class="string">''</span></div><div class="line">k = <span class="number">0</span></div><div class="line"><span class="keyword">for</span> p <span class="keyword">in</span> plain:</div><div class="line">    c += hex(ord(p) ^ key[k])[<span class="number">2</span>:].zfill(<span class="number">2</span>)</div><div class="line">    k = (k + <span class="number">1</span>) % len(key)</div><div class="line">cipher.write(c)</div></pre></td></tr></table></figure>
<p>程序意思是将明文和密钥逐字节异或，每次异或后的值用两位十六进制表示写入文件，也就是我们见到的code.txt，在这个过程中，密钥是循环使用的。</p>
<p>那么现在情况是这样的，我们知道：</p>
<blockquote>
<p> 密钥的长度区间为1-13字节</p>
<p> 加密方式为逐字节循环异或 </p>
<p> 加密结果，即密文的完整内容</p>
</blockquote>
<p>我们想知道</p>
<blockquote>
<p>明文内容 </p>
<p>密钥内容</p>
</blockquote>
<p>(⊙﹏⊙) 这看起来有点困难。</p>
<p>不过，其实还有两个不言而喻但非常重要的信息</p>
<blockquote>
<p>明文的每一个字节都是可见字符。</p>
<p>明文是一段有意义的话。</p>
</blockquote>
<h4 id="解密代码主程序"><a href="#解密代码主程序" class="headerlink" title="解密代码主程序"></a>解密代码主程序</h4><p>先放个主程序，和下面的对照着看。全部代码在<a href="#解密代码全文">文章底部</a> 。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    ps = []</div><div class="line">    ks = []</div><div class="line">    ss = []</div><div class="line">    ps.extend(xrange(<span class="number">32</span>, <span class="number">127</span>))</div><div class="line">    ks.extend(xrange(<span class="number">0xff</span> + <span class="number">1</span>))</div><div class="line">    ss.extend(xrange(<span class="number">1</span>, <span class="number">14</span>))</div><div class="line">    cipher = getCipher()</div><div class="line"></div><div class="line">    keyPool = getKeyPool(cipher=cipher, stepSet=ss, plainSet=ps, keySet=ks)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> keyPool:</div><div class="line">        freq = getFrequency(cipher, keyPool[i])</div><div class="line">        key = analyseFrequency(freq)</div><div class="line">        plain = vigenereDecrypt(cipher, key)</div><div class="line">        <span class="keyword">print</span> key, plain</div></pre></td></tr></table></figure>
<h4 id="确定密钥的长度和候选字符集"><a href="#确定密钥的长度和候选字符集" class="headerlink" title="确定密钥的长度和候选字符集"></a>确定密钥的长度和候选字符集</h4><p>明文由可见字符组成。这意味着任何一个使明文出现不可见字符的值都不可能出现在key里。<br>依据此可以取得两个进展。</p>
<ol>
<li>求出key的每一个字节有哪些候选字符。<br>具体操作：<br>当我们假设某一字节的key的值时，就可以使用前文提到的plain = cipher ^ key 求出这一字节密文对应的明文，如果这个明文是不可见的，那么我们假设的这个值就不可能出现在key的这个字节。<br>因为是循环异或，所以每个字节的key会去加密多个字节的明文，我们就可以如法炮制，大大缩小key的每个字节的候选字符集。</li>
<li>在1的基础上，确定key可能有哪几种长度。<br>具体操作：<br>我们假设key每一种可能的长度，一一去求对应的候选字符集， 如果有一种长度的key在某一字节的候选字符集为空，那么key就不可能是这个长度。</li>
</ol>
<p>至此，我们可以从无到有求得  <strong>key有哪些可能的长度</strong> 以及  <strong>key在每一种长度下对应的每个字节的候选字符集 </strong>。</p>
<p>上代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKeyPool</span><span class="params">(cipher, stepSet, plainSet, keySet)</span>:</span></div><div class="line">    <span class="string">''' 传入的密文串、明文字符集、密钥字符集、密钥长度范围均作为数字列表处理.形如[0x11,0x22,0x33]</span></div><div class="line"><span class="string">        返回一个字典，以可能的密钥长度为键，以对应的每一字节的密钥字符集构成的列表为值，</span></div><div class="line"><span class="string">        密钥字符集为数字列表。</span></div><div class="line"><span class="string">            形如&#123;</span></div><div class="line"><span class="string">                    1:[[0x11]],</span></div><div class="line"><span class="string">                    3:[</span></div><div class="line"><span class="string">                        [0x11,0x33,0x46],</span></div><div class="line"><span class="string">                        [0x22,0x58],</span></div><div class="line"><span class="string">                        [0x33]</span></div><div class="line"><span class="string">                       ]</span></div><div class="line"><span class="string">                &#125;</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    keyPool = dict()</div><div class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> stepSet:</div><div class="line">        maybe = [<span class="keyword">None</span>] * step</div><div class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> xrange(step):</div><div class="line">            maybe[pos] = []</div><div class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> keySet:</div><div class="line">                flag = <span class="number">1</span></div><div class="line">                <span class="keyword">for</span> c <span class="keyword">in</span> cipher[pos::step]:</div><div class="line">                    <span class="keyword">if</span> c ^ k <span class="keyword">not</span> <span class="keyword">in</span> plainSet:</div><div class="line">                        flag = <span class="number">0</span></div><div class="line">                <span class="keyword">if</span> flag:</div><div class="line">                    maybe[pos].append(k)</div><div class="line">        <span class="keyword">for</span> posPool <span class="keyword">in</span> maybe:</div><div class="line">            <span class="keyword">if</span> len(posPool) == <span class="number">0</span>:</div><div class="line">                maybe = []</div><div class="line">                <span class="keyword">break</span></div><div class="line">        <span class="keyword">if</span> len(maybe) != <span class="number">0</span>:</div><div class="line">            keyPool[step] = maybe</div><div class="line">    <span class="keyword">return</span> keyPool</div></pre></td></tr></table></figure>
<h4 id="遍历候选字符集，求出对应的字频"><a href="#遍历候选字符集，求出对应的字频" class="headerlink" title="遍历候选字符集，求出对应的字频"></a>遍历候选字符集，求出对应的字频</h4><p>这虽是个体力活，却也得小心翼翼。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFrequency</span><span class="params">(cipher, keyPoolList)</span>:</span></div><div class="line">    <span class="string">''' 传入的密文作为数字列表处理</span></div><div class="line"><span class="string">        传入密钥的字符集应为列表，依次包含各字节字符集。</span></div><div class="line"><span class="string">            形如[[0x11,0x12],[0x22]]</span></div><div class="line"><span class="string">        返回字频列表，依次为各字节字符集中每一字符作为密钥组成部分时对应的明文字频</span></div><div class="line"><span class="string">            形如[&#123;</span></div><div class="line"><span class="string">                    0x11:&#123;'a':2,'b':3&#125;,</span></div><div class="line"><span class="string">                    0x12:&#123;'e':6&#125;</span></div><div class="line"><span class="string">                 &#125;,</span></div><div class="line"><span class="string">                 &#123;</span></div><div class="line"><span class="string">                    0x22:&#123;'g':1&#125;</span></div><div class="line"><span class="string">                 &#125;]</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    freqList = []</div><div class="line">    keyLen = len(keyPoolList)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(keyLen):</div><div class="line">        posFreq = dict()</div><div class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> keyPoolList[i]:</div><div class="line">            posFreq[k] = dict()</div><div class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> cipher[i::keyLen]:</div><div class="line">                p = chr(k ^ c)</div><div class="line">                posFreq[k][p] = posFreq[k][p] + <span class="number">1</span> <span class="keyword">if</span> p <span class="keyword">in</span> posFreq[k] <span class="keyword">else</span> <span class="number">1</span></div><div class="line">        freqList.append(posFreq)</div><div class="line">    <span class="keyword">return</span> freqList</div></pre></td></tr></table></figure>
<h4 id="根据字频求得密钥"><a href="#根据字频求得密钥" class="headerlink" title="根据字频求得密钥"></a>根据字频求得密钥</h4><p>明文是一段有意义的话。这意味着它算出来的correlation值一定是所有候选明文中最大的，依照这一点就能挑出密钥每个字节的值，从而得到整个密钥。这也是整个解密过程最核心的一部分。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">calCorrelation</span><span class="params">(cpool)</span>:</span></div><div class="line">    <span class="string">'''传入字典，形如&#123;'e':2,'p':3&#125;</span></div><div class="line"><span class="string">        返回可能性，0~1,值越大可能性越大</span></div><div class="line"><span class="string">        (correlation between the decrypted column letter frequencies and</span></div><div class="line"><span class="string">        the relative letter frequencies for normal English text)</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    frequencies = &#123;<span class="string">"e"</span>: <span class="number">0.12702</span>, <span class="string">"t"</span>: <span class="number">0.09056</span>, <span class="string">"a"</span>: <span class="number">0.08167</span>, <span class="string">"o"</span>: <span class="number">0.07507</span>, <span class="string">"i"</span>: <span class="number">0.06966</span>,</div><div class="line">                   <span class="string">"n"</span>: <span class="number">0.06749</span>, <span class="string">"s"</span>: <span class="number">0.06327</span>, <span class="string">"h"</span>: <span class="number">0.06094</span>, <span class="string">"r"</span>: <span class="number">0.05987</span>, <span class="string">"d"</span>: <span class="number">0.04253</span>,</div><div class="line">                   <span class="string">"l"</span>: <span class="number">0.04025</span>, <span class="string">"c"</span>: <span class="number">0.02782</span>, <span class="string">"u"</span>: <span class="number">0.02758</span>, <span class="string">"m"</span>: <span class="number">0.02406</span>, <span class="string">"w"</span>: <span class="number">0.02360</span>,</div><div class="line">                   <span class="string">"f"</span>: <span class="number">0.02228</span>, <span class="string">"g"</span>: <span class="number">0.02015</span>, <span class="string">"y"</span>: <span class="number">0.01974</span>, <span class="string">"p"</span>: <span class="number">0.01929</span>, <span class="string">"b"</span>: <span class="number">0.01492</span>,</div><div class="line">                   <span class="string">"v"</span>: <span class="number">0.00978</span>, <span class="string">"k"</span>: <span class="number">0.00772</span>, <span class="string">"j"</span>: <span class="number">0.00153</span>, <span class="string">"x"</span>: <span class="number">0.00150</span>, <span class="string">"q"</span>: <span class="number">0.00095</span>,</div><div class="line">                   <span class="string">"z"</span>: <span class="number">0.00074</span>&#125;</div><div class="line">    relative = <span class="number">0.0</span></div><div class="line">    total = <span class="number">0</span></div><div class="line">    fpool = <span class="string">'etaoinshrdlcumwfgypbvkjxqz'</span></div><div class="line">    total = sum(cpool.values())  <span class="comment"># 总和应包括字母和其他可见字符</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cpool.keys():</div><div class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> fpool:</div><div class="line">            relative += frequencies[i] * cpool[i] / total</div><div class="line">    <span class="keyword">return</span> relative</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">analyseFrequency</span><span class="params">(cfreq)</span>:</span></div><div class="line">    key = []</div><div class="line">    <span class="keyword">for</span> posFreq <span class="keyword">in</span> cfreq:</div><div class="line">        mostRelative = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> keyChr <span class="keyword">in</span> posFreq.keys():</div><div class="line">            r = calCorrelation(posFreq[keyChr])</div><div class="line">            <span class="keyword">if</span> r &gt; mostRelative:</div><div class="line">                mostRelative = r</div><div class="line">                keychar = keyChr</div><div class="line">        key.append(keychar)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> key</div></pre></td></tr></table></figure>
<h4 id="根据密钥解密"><a href="#根据密钥解密" class="headerlink" title="根据密钥解密"></a>根据密钥解密</h4><p>求出密钥剩下的就好办了。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">vigenereDecrypt</span><span class="params">(cipher, key)</span>:</span></div><div class="line">    plain = <span class="string">''</span></div><div class="line">    cur = <span class="number">0</span></div><div class="line">    ll = len(key)</div><div class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> cipher:</div><div class="line">        plain += chr(c ^ key[cur])</div><div class="line">        cur = (cur + <span class="number">1</span>) % ll</div><div class="line">    <span class="keyword">return</span> plain</div></pre></td></tr></table></figure>
<h3 id="一些数据"><a href="#一些数据" class="headerlink" title="一些数据"></a>一些数据</h3><h4 id="可能的密钥长度和对应字符集"><a href="#可能的密钥长度和对应字符集" class="headerlink" title="可能的密钥长度和对应字符集"></a>可能的密钥长度和对应字符集</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">&#123;7: </div><div class="line">[[162, 165, 168, 169, 170, 174, 175, 178, 179, 180, 184, 185, 186, 187, 189, 190, 191], </div><div class="line"></div><div class="line">[0, 2, 10, 11, 12, 17, 21, 23, 25, 26, 27, 28, 29, 30, 31, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95], </div><div class="line"></div><div class="line">[132, 133, 142, 144, 145, 146, 147, 148, 149, 150, 155, 159, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202, 203, 204, 205, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223], </div><div class="line"></div><div class="line">[161, 166, 167, 170, 173, 176, 177, 178, 179, 180, 181, 182, 183, 186, 188], </div><div class="line"></div><div class="line">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 68, 70, 72, 76, 78, 80, 81, 82, 83, 84, 86, 87, 90, 93], </div><div class="line"></div><div class="line">[128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 195, 196, 200, 201, 202, 204, 205, 206, 207, 208, 210, 213, 216, 217, 223], </div><div class="line"></div><div class="line">[33, 39, 43, 44, 52, 55, 57, 58, 59, 60, 61, 62, 63]</div><div class="line">]&#125;</div></pre></td></tr></table></figure>
<h4 id="最后结果"><a href="#最后结果" class="headerlink" title="最后结果"></a>最后结果</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[186, 31, 145, 178, 83, 205, 62] Cryptography is the practice and study of techniques for, among other things, secure communication in the presence of attackers. Cryptography has been used for hundreds, if not thousands, of years, but traditional cryptosystems were designed and evaluated in a fairly ad hoc manner. For example, the Vigenere encryption scheme was thought to be secure for decades after it was invented, but we now know, and this exercise demonstrates, that it can be broken very easily.</div><div class="line">[Finished in 2.2s]</div></pre></td></tr></table></figure>
<h3 id="解密代码全文"><a href="#解密代码全文" class="headerlink" title="解密代码全文"></a>解密代码全文</h3><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment"># coding:utf8</span></div><div class="line"><span class="comment"># by https://findneo.github.io/</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCipher</span><span class="params">(file=<span class="string">'code.txt'</span>)</span>:</span></div><div class="line">    <span class="string">'''从文件中读取十六进制串，返回十六进制数组</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    c = open(file).read()</div><div class="line">    codeintlist = []</div><div class="line">    codeintlist.extend(</div><div class="line">        (map(<span class="keyword">lambda</span> i: int(c[i:i + <span class="number">2</span>], <span class="number">16</span>), range(<span class="number">0</span>, len(c), <span class="number">2</span>))))</div><div class="line">    <span class="keyword">return</span> codeintlist</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getKeyPool</span><span class="params">(cipher, stepSet, plainSet, keySet)</span>:</span></div><div class="line">    <span class="string">''' 传入的密文串、明文字符集、密钥字符集、密钥长度范围均作为数字列表处理.形如[0x11,0x22,0x33]</span></div><div class="line"><span class="string">        返回一个字典，以可能的密钥长度为键，以对应的每一字节的密钥字符集构成的列表为值，密钥字符集为数字列表。</span></div><div class="line"><span class="string">            形如&#123;</span></div><div class="line"><span class="string">                    1:[[0x11]],</span></div><div class="line"><span class="string">                    3:[</span></div><div class="line"><span class="string">                        [0x11,0x33,0x46],</span></div><div class="line"><span class="string">                        [0x22,0x58],</span></div><div class="line"><span class="string">                        [0x33]</span></div><div class="line"><span class="string">                       ]</span></div><div class="line"><span class="string">                &#125;</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    keyPool = dict()</div><div class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> stepSet:</div><div class="line">        maybe = [<span class="keyword">None</span>] * step</div><div class="line">        <span class="keyword">for</span> pos <span class="keyword">in</span> xrange(step):</div><div class="line">            maybe[pos] = []</div><div class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> keySet:</div><div class="line">                flag = <span class="number">1</span></div><div class="line">                <span class="keyword">for</span> c <span class="keyword">in</span> cipher[pos::step]:</div><div class="line">                    <span class="keyword">if</span> c ^ k <span class="keyword">not</span> <span class="keyword">in</span> plainSet:</div><div class="line">                        flag = <span class="number">0</span></div><div class="line">                <span class="keyword">if</span> flag:</div><div class="line">                    maybe[pos].append(k)</div><div class="line">        <span class="keyword">for</span> posPool <span class="keyword">in</span> maybe:</div><div class="line">            <span class="keyword">if</span> len(posPool) == <span class="number">0</span>:</div><div class="line">                maybe = []</div><div class="line">                <span class="keyword">break</span></div><div class="line">        <span class="keyword">if</span> len(maybe) != <span class="number">0</span>:</div><div class="line">            keyPool[step] = maybe</div><div class="line">    <span class="keyword">return</span> keyPool</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">calCorrelation</span><span class="params">(cpool)</span>:</span></div><div class="line">    <span class="string">'''传入字典，形如&#123;'e':2,'p':3&#125;</span></div><div class="line"><span class="string">        返回可能性，0~1,值越大可能性越大</span></div><div class="line"><span class="string">        (correlation between the decrypted column letter frequencies and</span></div><div class="line"><span class="string">        the relative letter frequencies for normal English text)</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    frequencies = &#123;<span class="string">"e"</span>: <span class="number">0.12702</span>, <span class="string">"t"</span>: <span class="number">0.09056</span>, <span class="string">"a"</span>: <span class="number">0.08167</span>, <span class="string">"o"</span>: <span class="number">0.07507</span>, <span class="string">"i"</span>: <span class="number">0.06966</span>,</div><div class="line">                   <span class="string">"n"</span>: <span class="number">0.06749</span>, <span class="string">"s"</span>: <span class="number">0.06327</span>, <span class="string">"h"</span>: <span class="number">0.06094</span>, <span class="string">"r"</span>: <span class="number">0.05987</span>, <span class="string">"d"</span>: <span class="number">0.04253</span>,</div><div class="line">                   <span class="string">"l"</span>: <span class="number">0.04025</span>, <span class="string">"c"</span>: <span class="number">0.02782</span>, <span class="string">"u"</span>: <span class="number">0.02758</span>, <span class="string">"m"</span>: <span class="number">0.02406</span>, <span class="string">"w"</span>: <span class="number">0.02360</span>,</div><div class="line">                   <span class="string">"f"</span>: <span class="number">0.02228</span>, <span class="string">"g"</span>: <span class="number">0.02015</span>, <span class="string">"y"</span>: <span class="number">0.01974</span>, <span class="string">"p"</span>: <span class="number">0.01929</span>, <span class="string">"b"</span>: <span class="number">0.01492</span>,</div><div class="line">                   <span class="string">"v"</span>: <span class="number">0.00978</span>, <span class="string">"k"</span>: <span class="number">0.00772</span>, <span class="string">"j"</span>: <span class="number">0.00153</span>, <span class="string">"x"</span>: <span class="number">0.00150</span>, <span class="string">"q"</span>: <span class="number">0.00095</span>,</div><div class="line">                   <span class="string">"z"</span>: <span class="number">0.00074</span>&#125;</div><div class="line">    relative = <span class="number">0.0</span></div><div class="line">    total = <span class="number">0</span></div><div class="line">    fpool = <span class="string">'etaoinshrdlcumwfgypbvkjxqz'</span></div><div class="line">    total = sum(cpool.values())  <span class="comment"># 总和应包括字母和其他可见字符</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cpool.keys():</div><div class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> fpool:</div><div class="line">            relative += frequencies[i] * cpool[i] / total</div><div class="line">    <span class="keyword">return</span> relative</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">analyseFrequency</span><span class="params">(cfreq)</span>:</span></div><div class="line">    key = []</div><div class="line">    <span class="keyword">for</span> posFreq <span class="keyword">in</span> cfreq:</div><div class="line">        mostRelative = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> keyChr <span class="keyword">in</span> posFreq.keys():</div><div class="line">            r = calCorrelation(posFreq[keyChr])</div><div class="line">            <span class="keyword">if</span> r &gt; mostRelative:</div><div class="line">                mostRelative = r</div><div class="line">                keychar = keyChr</div><div class="line">        key.append(keychar)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> key</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFrequency</span><span class="params">(cipher, keyPoolList)</span>:</span></div><div class="line">    <span class="string">''' 传入的密文作为数字列表处理</span></div><div class="line"><span class="string">        传入密钥的字符集应为列表，依次包含各字节字符集。</span></div><div class="line"><span class="string">            形如[[0x11,0x12],[0x22]]</span></div><div class="line"><span class="string">        返回字频列表，依次为各字节字符集中每一字符作为密钥组成部分时对应的明文字频</span></div><div class="line"><span class="string">            形如[&#123;</span></div><div class="line"><span class="string">                    0x11:&#123;'a':2,'b':3&#125;,</span></div><div class="line"><span class="string">                    0x12:&#123;'e':6&#125;</span></div><div class="line"><span class="string">                 &#125;,</span></div><div class="line"><span class="string">                 &#123;</span></div><div class="line"><span class="string">                    0x22:&#123;'g':1&#125;</span></div><div class="line"><span class="string">                 &#125;]</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    freqList = []</div><div class="line">    keyLen = len(keyPoolList)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(keyLen):</div><div class="line">        posFreq = dict()</div><div class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> keyPoolList[i]:</div><div class="line">            posFreq[k] = dict()</div><div class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> cipher[i::keyLen]:</div><div class="line">                p = chr(k ^ c)</div><div class="line">                posFreq[k][p] = posFreq[k][p] + <span class="number">1</span> <span class="keyword">if</span> p <span class="keyword">in</span> posFreq[k] <span class="keyword">else</span> <span class="number">1</span></div><div class="line">        freqList.append(posFreq)</div><div class="line">    <span class="keyword">return</span> freqList</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">vigenereDecrypt</span><span class="params">(cipher, key)</span>:</span></div><div class="line">    plain = <span class="string">''</span></div><div class="line">    cur = <span class="number">0</span></div><div class="line">    ll = len(key)</div><div class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> cipher:</div><div class="line">        plain += chr(c ^ key[cur])</div><div class="line">        cur = (cur + <span class="number">1</span>) % ll</div><div class="line">    <span class="keyword">return</span> plain</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    ps = []</div><div class="line">    ks = []</div><div class="line">    ss = []</div><div class="line">    ps.extend(xrange(<span class="number">32</span>, <span class="number">127</span>))</div><div class="line">    ks.extend(xrange(<span class="number">0xff</span> + <span class="number">1</span>))</div><div class="line">    ss.extend(xrange(<span class="number">1</span>, <span class="number">14</span>))</div><div class="line">    cipher = getCipher()</div><div class="line"></div><div class="line">    keyPool = getKeyPool(cipher=cipher, stepSet=ss, plainSet=ps, keySet=ks)</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> keyPool:</div><div class="line">        freq = getFrequency(cipher, keyPool[i])</div><div class="line">        key = analyseFrequency(freq)</div><div class="line">        plain = vigenereDecrypt(cipher, key)</div><div class="line">        <span class="keyword">print</span> key, plain</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<h3 id="题目备份"><a href="#题目备份" class="headerlink" title="题目备份"></a>题目备份</h3><figure class="highlight c"><table><tr><td class="code"><pre><div class="line">http:<span class="comment">//ctf.nuptsast.com/static/uploads/13706e3281c1fb0c04417d3452cb745b/encode.cpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> KEY_LENGTH 2 <span class="comment">// Can be anything from 1 to 13</span></span></div><div class="line"></div><div class="line">main()&#123;</div><div class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> ch;</div><div class="line">  FILE *fpIn, *fpOut;</div><div class="line">  <span class="keyword">int</span> i;</div><div class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> key[KEY_LENGTH] = &#123;<span class="number">0x00</span>, <span class="number">0x00</span>&#125;;</div><div class="line">  <span class="comment">/* of course, I did not use the all-0s key to encrypt */</span></div><div class="line"></div><div class="line">  fpIn = fopen(<span class="string">"ptext.txt"</span>, <span class="string">"r"</span>);</div><div class="line">  fpOut = fopen(<span class="string">"ctext.txt"</span>, <span class="string">"w"</span>);</div><div class="line"></div><div class="line">  i=<span class="number">0</span>;</div><div class="line">  <span class="keyword">while</span> (<span class="built_in">fscanf</span>(fpIn, <span class="string">"%c"</span>, &amp;ch) != EOF) &#123;</div><div class="line">    <span class="comment">/* avoid encrypting newline characters */</span>  </div><div class="line">    <span class="comment">/* In a "real-world" implementation of the Vigenere cipher, </span></div><div class="line"><span class="comment">       every ASCII character in the plaintext would be encrypted.</span></div><div class="line"><span class="comment">       However, I want to avoid encrypting newlines here because </span></div><div class="line"><span class="comment">       it makes recovering the plaintext slightly more difficult... */</span></div><div class="line">    <span class="comment">/* ...and my goal is not to create "production-quality" code =) */</span></div><div class="line">    <span class="keyword">if</span> (ch!=<span class="string">'\n'</span>) &#123;</div><div class="line">      <span class="built_in">fprintf</span>(fpOut, <span class="string">"%02X"</span>, ch ^ key[i % KEY_LENGTH]); <span class="comment">// ^ is logical XOR    </span></div><div class="line">      i++;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">  fclose(fpIn);</div><div class="line">  fclose(fpOut);</div><div class="line">  <span class="keyword">return</span>;</div><div class="line">&#125; </div><div class="line">----------------------------------------------------------------------------------</div><div class="line">http:<span class="comment">//ctf.nuptsast.com/static/uploads/9a27a6c8b9fb7b8d2a07ad94924c02e5/code.txt</span></div><div class="line"></div><div class="line">F96DE8C227A259C87EE1DA2AED57C93FE5DA36ED4EC87EF2C63AAE5B9A7EFFD673BE4ACF7BE8923CAB1ECE7AF2DA3DA44FCF7AE29235A24C963FF0DF3CA3599A70E5DA36BF1ECE77F8DC34BE129A6CF4D126BF5B9A7CFEDF3EB850D37CF0C63AA2509A76FF9227A55B9A6FE3D720A850D97AB1DD35ED5FCE6BF0D138A84CC931B1F121B44ECE70F6C032BD56C33FF9D320ED5CDF7AFF9226BE5BDE3FF7DD21ED56CF71F5C036A94D963FF8D473A351CE3FE5DA3CB84DDB71F5C17FED51DC3FE8D732BF4D963FF3C727ED4AC87EF5DB27A451D47EFD9230BF47CA6BFEC12ABE4ADF72E29224A84CDF3FF5D720A459D47AF59232A35A9A7AE7D33FB85FCE7AF5923AA31EDB3FF7D33ABF52C33FF0D673A551D93FFCD33DA35BC831B1F43CBF1EDF67F0DF23A15B963FE5DA36ED68D378F4DC36BF5B9A7AFFD121B44ECE76FEDC73BE5DD27AFCD773BA5FC93FE5DA3CB859D26BB1C63CED5CDF3FE2D730B84CDF3FF7DD21ED5ADF7CF0D636BE1EDB79E5D721ED57CE3FE6D320ED57D469F4DC27A85A963FF3C727ED49DF3FFFDD24ED55D470E69E73AC50DE3FE5DA3ABE1EDF67F4C030A44DDF3FF5D73EA250C96BE3D327A84D963FE5DA32B91ED36BB1D132A31ED87AB1D021A255DF71B1C436BF479A7AF0C13AA14794</div></pre></td></tr></table></figure>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ul>
<li><a href="https://en.wikipedia.org/wiki/Index_of_coincidence" target="_blank" rel="external">https://en.wikipedia.org/wiki/Index_of_coincidence</a></li>
<li><a href="https://en.wikipedia.org/wiki/One-time_pad" target="_blank" rel="external">https://en.wikipedia.org/wiki/One-time_pad</a></li>
<li><a href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher" target="_blank" rel="external">https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher</a></li>
<li><a href="https://en.wikipedia.org/wiki/Letter_frequency" target="_blank" rel="external">https://en.wikipedia.org/wiki/Letter_frequency</a></li>
<li><a href="https://www.lijinma.com/blog/2014/05/29/amazing-xor/" target="_blank" rel="external">https://www.lijinma.com/blog/2014/05/29/amazing-xor/</a></li>
<li><a href="http://blog.csdn.net/qq_31344951/article/details/77934717" target="_blank" rel="external">http://blog.csdn.net/qq_31344951/article/details/77934717</a></li>
</ul>

      
    </div>
    
    
    

    

    

    
      <div>
        
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    <a href="https://findneo.github.io/" title="欢迎访问 findneo 的博客"> findneo</a>
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://findneo.github.io/2017/10/nupt-vigenere/" title="南邮CTF平台 Vigenere writeup">https://findneo.github.io/2017/10/nupt-vigenere/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/ctf/" rel="tag"># ctf</a>
          
            <a href="/tags/密码学/" rel="tag"># 密码学</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/10/nupt-zonghe2/" rel="next" title="南邮CTF平台综合题2writeup">
                <i class="fa fa-chevron-left"></i> 南邮CTF平台综合题2writeup
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/10/2017-miac-writeup/" rel="prev" title="2017 miac writeup">
                2017 miac writeup <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.ico"
                alt="findneo" />
            
              <p class="site-author-name" itemprop="name">findneo</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/findneo" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="javascript:alert('dfindneo@gmail.com')" target="_blank" title="E-Mail">
                    
                      <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://chybeta.github.io/" title="Chybeta" target="_blank">Chybeta</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lxpark.com/" title="lzhtony" target="_blank">lzhtony</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.madsome.cn/" title="Mads" target="_blank">Mads</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ph0en1x.com/" title="Ph0en1x" target="_blank">Ph0en1x</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#题目"><span class="nav-number">1.</span> <span class="nav-text">题目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是异或"><span class="nav-number">2.</span> <span class="nav-text">什么是异或</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#概念"><span class="nav-number">3.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解题"><span class="nav-number">4.</span> <span class="nav-text">解题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#理解加密"><span class="nav-number">4.1.</span> <span class="nav-text">理解加密</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解密代码主程序"><span class="nav-number">4.2.</span> <span class="nav-text">解密代码主程序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#确定密钥的长度和候选字符集"><span class="nav-number">4.3.</span> <span class="nav-text">确定密钥的长度和候选字符集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#遍历候选字符集，求出对应的字频"><span class="nav-number">4.4.</span> <span class="nav-text">遍历候选字符集，求出对应的字频</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#根据字频求得密钥"><span class="nav-number">4.5.</span> <span class="nav-text">根据字频求得密钥</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#根据密钥解密"><span class="nav-number">4.6.</span> <span class="nav-text">根据密钥解密</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#一些数据"><span class="nav-number">5.</span> <span class="nav-text">一些数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#可能的密钥长度和对应字符集"><span class="nav-number">5.1.</span> <span class="nav-text">可能的密钥长度和对应字符集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#最后结果"><span class="nav-number">5.2.</span> <span class="nav-text">最后结果</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解密代码全文"><span class="nav-number">6.</span> <span class="nav-text">解密代码全文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#题目备份"><span class="nav-number">7.</span> <span class="nav-text">题目备份</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考链接"><span class="nav-number">8.</span> <span class="nav-text">参考链接</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-pencil"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">findneo</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: window.location.pathname, 
            owner: 'findneo',
            repo: 'findneo.github.io',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: 'ad6c900a0fce4a44b8eeb40e1790ee7c7cc7575d',
            
                client_id: 'a3407310dfbeafbfe55a'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    







  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  

  

  

</body>
</html>
